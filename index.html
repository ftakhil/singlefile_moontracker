<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lunar Phase Explorer üåô</title>
  <style>
    :root {
      --bg0: #070815;
      --bg1: #0b0f24;
      --bg2: #0f1533;
      --accent: #8ab4ff;
      --accent-2: #b388ff;
      --text: #e6e9f2;
      --muted: #a6accd;
      --card: #12172e;
      --ring: 0 0 40px rgba(138,180,255,.25), 0 0 120px rgba(179,136,255,.15);
    }
    * { box-sizing: border-box }
    html, body { margin:0; height:100%; scroll-behavior:smooth; }
    body{ 
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text);
      background:
        radial-gradient(1200px 600px at 10% -10%, #171a3a 0%, rgba(23,26,58,0) 60%),
        radial-gradient(900px 500px at 110% 10%, #361e56 0%, rgba(54,30,86,0) 60%),
        linear-gradient(#060713, #090b1d 40%, #060713 100%);
      min-height:100vh;
    }
    /* Header */
    .nav { position: sticky; top:0; z-index:50; background: rgba(6,7,19,.6); backdrop-filter: blur(8px); border-bottom:1px solid rgba(255,255,255,.06) }
    .container{ max-width:1100px; margin:0 auto; padding: 0 20px; }
    .navbar{ display:flex; align-items:center; justify-content:space-between; padding:14px 0 }
    .brand{ display:flex; align-items:center; gap:10px; font-weight:700; letter-spacing:.3px }
    .brand .logo{ width:28px; height:28px; border-radius:50%; background: radial-gradient(circle at 30% 35%, #fff 0 45%, #cdd6ff 50% 60%, #a3adff 61% 100%); box-shadow: var(--ring); }
    .btn{ background: linear-gradient(135deg, var(--accent), var(--accent-2)); color:#05070f; border:none; border-radius:999px; padding:10px 16px; font-weight:700; cursor:pointer; transition: transform .2s ease, box-shadow .2s ease; box-shadow:0 8px 20px rgba(138,180,255,.25)}
    .btn:hover{ transform: translateY(-1px); box-shadow:0 12px 24px rgba(138,180,255,.35)}

    /* Hero */
    .hero{ display:grid; grid-template-columns: 1.2fr .8fr; gap:24px; align-items:center; padding: 64px 0 56px }
    .title{ font-size: clamp(28px, 5vw, 56px); line-height:1.05; margin:0 0 14px; }
    .subtitle{ color: var(--muted); font-size: clamp(16px, 2vw, 18px); max-width:60ch }
    .ctaRow{ display:flex; gap:12px; margin-top:22px }
    .moon-orb{ position:relative; width:min(360px, 80%); aspect-ratio:1/1; border-radius:50%; margin: 0 auto; background: radial-gradient(circle at 30% 35%, #fff 0 45%, #cdd6ff 50% 60%, #a3adff 61% 100%); box-shadow: var(--ring); animation: float 6s ease-in-out infinite; }
    .moon-orb::after{ content: ""; position:absolute; inset:-24px; border-radius:inherit; background: radial-gradient(circle, rgba(138,180,255,.08), rgba(179,136,255,.05), transparent 60%); filter: blur(8px); z-index:-1 }
    @keyframes float { 0%,100%{ transform: translateY(0) } 50%{ transform: translateY(-10px) } }

    /* Sections */
    section { padding: 56px 0 }
    .card{ background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.08); border-radius:20px; padding:18px; box-shadow: 0 12px 24px rgba(0,0,0,.25) }
    .grid{ display:grid; grid-template-columns: repeat( auto-fill, minmax(180px, 1fr) ); gap:16px }

    /* Footer */
    footer{ border-top:1px solid rgba(255,255,255,.06); color:var(--muted); padding: 30px 0 60px; text-align:center }

    /* Form bits */
    .row{ display:flex; flex-wrap:wrap; gap:10px }
    input, select{ background:#0c1124; color:var(--text); border:1px solid rgba(255,255,255,.1); border-radius:12px; padding:10px 12px; outline:none }
    input::placeholder{ color:#7e86ad }

    /* Small screens */
    @media (max-width: 860px){
      .hero{ grid-template-columns: 1fr; text-align:center }
      .moon-orb{ width:min(340px, 70%); }
      .ctaRow{ justify-content:center }
    }
  </style>
</head>
<body>
  <header class="nav">
    <div class="container navbar">
      <div class="brand"><div class="logo"></div> Lunar Phase Explorer</div>
      <button class="btn" onclick="document.getElementById('tracker').scrollIntoView({behavior:'smooth'})">View Phases</button>
    </div>
  </header>

  <main>
    <!-- HERO / Landing Page -->
    <section class="container hero" id="home">
      <div>
        <h1 class="title">Explore the Moon's Journey Through Time</h1>
        <p class="subtitle">Track lunar phases with precision using your location. Get detailed moon phase information and visualizations for the next week.</p>
        <div class="ctaRow">
          <button class="btn" onclick="document.getElementById('tracker').scrollIntoView({behavior:'smooth'})">View Moon Phases</button>
          <button class="btn" style="background:linear-gradient(135deg,#1beabd,#6a82fb);" onclick="useMyLocation()">Set Location</button>
        </div>
      </div>
      <div class="moon-orb" aria-hidden="true"></div>
    </section>

    <!-- TRACKER -->
    <section id="tracker">
      <div class="container">
        <div class="row" style="align-items:center; justify-content:space-between; margin-bottom:14px">
          <h2 style="margin:0">Current Phase</h2>
          <div class="row">
            <input id="lat" type="number" step="any" placeholder="Latitude" style="width:170px">
            <input id="lon" type="number" step="any" placeholder="Longitude" style="width:180px">
          </div>
        </div>

        <div id="todayCard" class="card" style="display:grid; grid-template-columns: 160px 1fr; gap:16px; align-items:center">
          <div style="width:160px; height:160px; display:grid; place-items:center; background:rgba(255,255,255,.03); border-radius:16px">
            <img id="todayImg" alt="Moon image" style="width:140px; height:140px; object-fit:contain; filter: drop-shadow(0 0 24px rgba(138,180,255,.35));" />
          </div>
          <div>
            <div style="opacity:.8; font-size:14px" id="todayDate"></div>
            <h3 id="todayPhase" style="margin:.2rem 0 .6rem 0"></h3>
            <div id="todayMeta" style="color:var(--muted)"></div>
            <div style="margin-top:12px" class="row">
              <button id="next7Btn" class="btn">Show Next 7 Days</button>
              <button class="btn" style="background:linear-gradient(135deg,#f6d365,#fda085)" onclick="useMyLocation()">üìç Detect Location</button>
            </div>
          </div>
        </div>

        <div style="display:flex; align-items:center; gap:10px; margin:24px 0 10px">
          <h2 style="margin:0">Weekly Forecast</h2>
          <span style="color:var(--muted)">Upcoming phases</span>
        </div>
        <div id="weekGrid" class="grid"></div>
        <p id="note" style="color:var(--muted); margin-top:12px"></p>
      </div>
    </section>
  </main>

  <footer>
    <div class="container">Built with AstronomyAPI ¬∑ ¬© 2024 Lunar Phase Explorer</div>
  </footer>

  <script>
    // --- Utilities ---
    const $ = (sel) => document.querySelector(sel);
    const fmt = (d) => new Intl.DateTimeFormat(undefined,{dateStyle:'medium'}).format(d);

    // Phase name fallback (approximation)
    function phaseNameFor(date){
      // Algorithm based on known new moon (2000-01-06 18:14 UTC)
      const synodic = 29.53058867;
      const known = Date.UTC(2000,0,6,18,14,0)/86400000; // days
      const d = date.getTime()/86400000;
      let days = (d - known) % synodic; if(days<0) days += synodic;
      const age = days;
      const pct = age / synodic; // 0..1
      if(pct < 0.03 || pct > 0.97) return 'New Moon';
      if(pct < 0.22) return 'Waxing Crescent';
      if(pct < 0.28) return 'First Quarter';
      if(pct < 0.47) return 'Waxing Gibbous';
      if(pct < 0.53) return 'Full Moon';
      if(pct < 0.72) return 'Waning Gibbous';
      if(pct < 0.78) return 'Last Quarter';
      return 'Waning Crescent';
    }

    function emojiFor(phase){
      return {
        'New Moon':'üåë', 'Waxing Crescent':'üåí', 'First Quarter':'üåì', 'Waxing Gibbous':'üåî',
        'Full Moon':'üåï', 'Waning Gibbous':'üåñ', 'Last Quarter':'üåó', 'Waning Crescent':'üåò'
      }[phase] || 'üåô';
    }

    // Location helper
    async function useMyLocation(){
      if(!navigator.geolocation){ alert('Geolocation not supported. Enter lat/lon manually.'); return }
      navigator.geolocation.getCurrentPosition(pos => {
        const {latitude, longitude} = pos.coords; $('#lat').value = latitude.toFixed(6); $('#lon').value = longitude.toFixed(6);
        loadToday();
      }, err => alert('Location error: '+ err.message));
    }

    // Simplified fetchMoonImage to always use emoji fallback
    async function fetchMoonImage(date, lat, lon){
      return null; // Always use emoji fallback
    }

    // Render helpers
    function weekDates(start){
      return Array.from({length:7}, (_,i)=> new Date(start.getFullYear(), start.getMonth(), start.getDate()+1+i));
    }

    async function renderDayCard(container, date, lat, lon){
      const phase = phaseNameFor(date);
      const url = await fetchMoonImage(date, lat, lon);
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <div style="display:grid; gap:10px; place-items:center">
          <div style="width:120px;height:120px;display:grid;place-items:center;background:rgba(255,255,255,.03); border-radius:14px">
            ${ url ? `<img src="${url}" alt="${phase}" style="width:100px;height:100px;object-fit:contain;filter: drop-shadow(0 0 18px rgba(138,180,255,.3))">`
                   : `<div style="font-size:64px">${emojiFor(phase)}</div>`}
          </div>
          <div style="text-align:center">
            <div style="opacity:.8;font-size:12px">${fmt(date)}</div>
            <div style="font-weight:700">${phase}</div>
          </div>
        </div>`;
      container.appendChild(card);
    }

    async function loadToday(){
      const lat = $('#lat').value || '8.5241';
      const lon = $('#lon').value || '76.9366';
      const today = new Date();
      $('#todayDate').textContent = fmt(today);
      const phase = phaseNameFor(today);
      $('#todayPhase').textContent = phase;
      $('#todayMeta').textContent = `Location: ${Number(lat).toFixed(3)}¬∞N, ${Number(lon).toFixed(3)}¬∞E`;

      $('#todayImg').alt = 'moon';
      $('#todayImg').src = 'data:image/svg+xml;utf8,'+ encodeURIComponent(`<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 120 120\"><rect width=\"100%\" height=\"100%\" fill=\"transparent\"/><text x=\"60\" y=\"76\" font-size=\"64\" text-anchor=\"middle\">${emojiFor(phase)}</text></svg>`);
      $('#note').textContent = 'Using calculated phase data with emoji visualization';
    }

    async function loadWeek(){
      const grid = $('#weekGrid'); grid.innerHTML = '';
      const start = new Date();
      const lat = $('#lat').value || '8.5241';
      const lon = $('#lon').value || '76.9366';
      const dates = weekDates(start);
      for(const d of dates){ await renderDayCard(grid, d, lat, lon); }
    }

    // Events
    document.addEventListener('DOMContentLoaded', () => {
      loadToday();
      $('#next7Btn').addEventListener('click', loadWeek);
    });
  </script>
</body>
</html>